---
import "../playground/styles.css";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Write and run your Telegram bot code in TypeScript directly in your browser."
    />
    <meta property="og:title" content="Telegram Bot Playground | Telegram Bot SDK" />
    <meta property="og:description" content="Write and run your Telegram bot code in TypeScript directly in your browser." />
    <meta property="og:image" content="https://tg-bot-sdk.website/og-banner.png" />
    <meta property="og:url" content="https://tg-bot-sdk.website/playground/" />
    <meta property="og:type" content="website" />
    <link rel="canonical" href="https://tg-bot-sdk.website/playground/" />
    <title>Telegram Bot Playground | Telegram Bot SDK</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  <body class="bg-slate-50 flex flex-col h-screen overflow-hidden">
    <div x-data="playground" @keydown.window.meta.enter.prevent="runIfConnected()" @keydown.window.ctrl.enter.prevent="runIfConnected()" class="flex flex-col h-full">

      <header class="flex items-center gap-4 px-4 py-3 border-b border-gray-200 bg-white">
        <a href="/" class="text-blue-600 hover:underline text-sm whitespace-nowrap">&larr; Docs</a>
        <span class="text-lg font-bold text-gray-800 whitespace-nowrap">Playground</span>

        <select
          x-model="activeExample"
          @change="selectExample($event.target.value)"
          class="px-2 py-1 border border-gray-300 rounded bg-white text-sm"
        >
          <option value="empty.ts">Simple Bot</option>
          <option value="echo.ts">Echo Bot</option>
          <option value="command.ts">Command Bot</option>
          <option value="file.ts">File Bot</option>
        </select>

        <span
          x-show="errorCount > 0"
          x-cloak
          class="text-xs text-red-500 font-mono"
          x-text="errorCount + ' error' + (errorCount === 1 ? '' : 's')"
        ></span>

        <div class="flex items-center gap-1">
          <button
            x-show="isConnected && botDot !== 'running'"
            x-cloak
            @click="runCurrentCode()"
            class="px-2 py-1 text-sm rounded hover:bg-green-50 active:bg-green-100 text-green-700 whitespace-nowrap flex items-center gap-1.5"
          >&#9654; Run <span class="text-[10px] text-gray-400 font-mono" x-text="shortcutHint"></span></button>
          <button
            x-show="isConnected && botDot === 'running'"
            x-cloak
            @click="stopBot()"
            class="px-2 py-1 text-sm rounded hover:bg-red-50 active:bg-red-100 text-red-600 whitespace-nowrap"
            title="Stop"
          >&#9632; Stop</button>
        </div>

        <div class="ml-auto flex items-center gap-2 text-sm">
          <span class="flex items-center gap-1.5" :class="statusClass">
            <span class="w-2 h-2 rounded-full inline-block" :class="dotClass"></span>
            <span x-html="statusText"></span>
          </span>
          <button
            @click="connectBot()"
            class="px-3 py-1 border rounded hover:bg-gray-100 active:bg-gray-200 whitespace-nowrap"
            x-text="isConnected ? 'Reconnect' : 'Connect bot'"
          ></button>
          <button
            x-show="hasSavedToken && isConnected"
            x-cloak
            @click="forgetToken()"
            class="px-2 py-1 text-xs text-gray-400 hover:text-red-500 whitespace-nowrap"
            title="Remove saved token"
          >Forget</button>
        </div>
      </header>

      <!-- Token input modal -->
      <div x-show="tokenModal.open" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black/30">
        <div class="bg-white rounded-lg shadow-lg w-[420px] p-5" @keydown.escape="cancelToken()">
          <h3 class="text-sm font-semibold text-gray-800 mb-3">Connect your bot</h3>

          <input
            x-model="tokenModal.value"
            @keydown.enter="submitToken()"
            type="text"
            placeholder="Paste bot token from BotFather"
            class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500 mb-3"
            autocomplete="off"
            spellcheck="false"
            x-ref="tokenInput"
          />

          <p x-show="tokenModal.error" x-text="tokenModal.error" class="text-xs text-red-600 mb-2"></p>

          <div class="flex justify-end gap-2">
            <button @click="cancelToken()" class="px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
            <button @click="submitToken()" class="px-3 py-1.5 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded">Connect</button>
          </div>
        </div>
      </div>

      <!-- Confirm modal (for webhook deletion) -->
      <div x-show="confirmModal.open" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black/30">
        <div class="bg-white rounded-lg shadow-lg w-[420px] p-5">
          <h3 class="text-sm font-semibold text-gray-800 mb-2">Webhook detected</h3>
          <p x-text="confirmModal.description" class="text-xs text-gray-600 mb-4 whitespace-pre-line"></p>
          <div class="flex justify-end gap-2">
            <button @click="resolveConfirm(false)" class="px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
            <button @click="resolveConfirm(true)" class="px-3 py-1.5 text-sm text-white bg-red-600 hover:bg-red-700 rounded">Delete webhook</button>
          </div>
        </div>
      </div>

      <!-- Toast notifications -->
      <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex flex-col items-center gap-2">
        <template x-for="toast in toasts" :key="toast.id">
          <div
            class="px-4 py-2 rounded-lg shadow-lg text-sm font-medium"
            :class="[
              toast.type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white',
              toast.exiting ? 'toast-exit' : 'toast-enter'
            ]"
            x-text="toast.text"
          ></div>
        </template>
      </div>

      <!-- Stats bar -->
      <div
        x-show="isConnected && (stats.handled + stats.ignored + stats.noHandler + stats.errors) > 0"
        x-cloak
        class="flex items-center gap-4 px-4 py-1.5 border-b border-gray-200 bg-white text-xs font-mono"
      >
        <span class="text-green-700">Handled: <span x-text="stats.handled"></span></span>
        <span class="text-gray-500">Ignored: <span x-text="stats.ignored"></span></span>
        <span class="text-yellow-600">No handler: <span x-text="stats.noHandler"></span></span>
        <span class="text-red-600">Errors: <span x-text="stats.errors"></span></span>
      </div>

      <main
        x-ref="mainContainer"
        class="flex flex-1 min-h-0"
        :class="isDragging ? 'select-none' : ''"
      >
        <div id="code-editor" class="min-w-0 overflow-hidden" :style="`width: ${editorWidth}%`"></div>

        <div
          class="panel-divider"
          :class="isDragging ? 'dragging' : ''"
          @mousedown="startDrag($event)"
        ></div>

        <div class="flex-1 min-w-[200px] flex flex-col bg-gray-50">
          <div class="flex items-center justify-between px-3 py-2 border-b border-gray-200">
            <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">
              Logs<span x-show="filteredLogs.length > 0" class="ml-1 text-gray-400" x-text="'(' + filteredLogs.length + ')'"></span>
            </span>
            <div class="flex items-center gap-2">
              <button
                @click="toggleVerbose()"
                class="text-[10px] px-1.5 py-0.5 rounded"
                :class="verbose ? 'bg-blue-100 text-blue-700' : 'text-gray-400 hover:text-gray-600'"
              >Verbose</button>
              <button
                @click="logs = []"
                class="text-xs text-gray-400 hover:text-gray-600"
              >
                Clear
              </button>
            </div>
          </div>
          <div
            x-ref="logsContainer"
            class="flex-1 overflow-y-auto hide-scrollbar p-2 font-mono text-xs"
          >
            <template x-for="(log, i) in filteredLogs" :key="i">
              <div
                class="px-2 py-1.5 border-b border-gray-200 border-l-2 whitespace-pre-wrap"
                :class="[logBorderClass(log), _isCollapsible(log) ? 'cursor-pointer hover:bg-gray-100' : '']"
                @click="toggleLog(i)"
              >
                <span class="text-gray-400 select-none" x-text="log.time + '  '"></span>
                <span
                  x-show="_isCollapsible(log)"
                  class="text-gray-400 select-none"
                  x-text="log.collapsed ? '\u25B6 ' : '\u25BC '"
                ></span>
                <span :class="log.isUpdate ? 'text-blue-700' : ''" x-text="logDisplayText(log)"></span>
              </div>
            </template>
          </div>
        </div>
      </main>

    </div>
  </body>
</html>

<style>
  @import "tailwindcss";

  [x-cloak] {
    display: none !important;
  }
</style>
